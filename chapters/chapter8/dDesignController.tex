\section{Design of the Controller}\label{designController}
The design of the controller is based on the root locus plot, where the final location of the poles in closed loop can be seen.

The root locus of the system with a proportional controller can be seen in \figref{rlocusCubli2}.

\begin{figure}[H]
	\centering 
	\includegraphics[scale=.75]{figures/rlocusCubli}
	\captionof{figure}{Root Locus of the system. It has  one zero \si{(s=0)}, and three poles \si{(s=-10,5014}, \si{s=-0,0283} and \si{s=9,3531}).}
	\label{rlocusCubli2}
\end{figure}

Looking at the root locus it can be derived that the system can not be controlled using only a proportional controller because there is always a pole in the RHP no matter the gain.

However, a first approximation of the system's behavior in closed loop can be done through a proportional controller. Such a system is tested with a gain of 10 as a controller. The final closed loop poles are placed at \si{-40,4198;\ -0,0018\ and\ 39,2448}. In \figref{closedLoopResponse} it is shown the response of the simulation and the one from the real setup with this proportional controller.

\begin{figure}[H] 
	\centering 
	\includegraphics[scale=0.75]{figures/closedLoopResponse}	
	\caption{Behavior of the closed loop function with a proportional controller, both in simulation and reality.}
	\label{closedLoopResponse}
\end{figure}
%
It is clear that, upon application of a \SI{0}{rad} reference and a minimal initial offset, the closed loop function with only a gain of 10 has an unstable response. Then the branches of the root locus need to be changed by means of the addition of poles and zeros in the controller.

As there exists one pole in the Right Half Plane (RHP), the controller must also have one there to create two branches which can be attracted to the Left Half Plane (LHP).

Then, two zeros must be placed in the LHP to make the branches enter in the stable region of the plot.

It is also important for the number of poles to be greater than the number of zeros so that the controller is feasible in reality. This means that two poles need to be placed somewhere so they don't affect the behavior of the final system. This can be achieved if they are placed in the LHP and far from the imaginary axis.

Finally, the gain must be adjusted to make the closed loop poles to be in a stable location. The resultant Root Locus can be seen in \figref{RLControllerZoom}.

\begin{figure}[H]
	\centering 
	\includegraphics[scale=.65]{figures/RLControllerZoom}
	\captionof{figure}{Root Locus of the final system.}
	\label{RLControllerZoom}
\end{figure}
%
The final system looks like \figref{blockDiagramController} and the transfer function of the controller is give by \eqref{ControllerLaplace}.
%
\begin{figure}[H]
	\input{figures/blockDiagramController.tikz}
	\centering
	\caption{Block diagram of the final controlled system.}
	\label{blockDiagramController}
\end{figure}
%
Where
%
\begin{flalign}
	\eq{D(s)} {0,62737 \cdot \frac{(0,1054\ s + 1)\cdot (0,6254\ s + 1)}{(0,1805\ s - 1) \cdot (0,01\ s + 1) \cdot (0,005\ s + 1)}} & \nonumber\\
	\label{ControllerLaplace}
\end{flalign}
%
The stability of the controlled system can be then analyzed using the Nyquist plot of the controller and the plant together in open loop, as seen in \figref{nyquistController}.

\begin{figure}[H] 
	\centering 
	\includegraphics[scale=0.55]{figures/nyquistController}	
	\caption{Nyquist plot of the system with the controller.}
\end{figure}	\label{nyquistController}

Now there are two poles in the RHP and the number of encirclements around -1 equals -2 (they are counterclockwise). 
This means that the system should be stable, as the number of zeros in the RHP becomes 0, (see \secref{sec:stabilityAnalysis}).